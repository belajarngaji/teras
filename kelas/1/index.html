<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teras | Belajar Ngaji</title>
  <meta name="description" content="Jelajahi semua fitur seru">
  <link rel="icon" href="../favicon.ico" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: 'Poppins', sans-serif; transition: background 0.3s, color 0.3s; }
    .dark-mode { background: #1e293b; color: #f1f5f9; }
    .container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }
  </style>
</head>
<body class="bg-gray-50">
  <!-- NAVBAR -->
  <nav class="flex justify-between items-center bg-blue-600 text-white px-6 py-4 shadow-md">
    <!-- Total Skor -->
    <div id="total-score" class="text-lg font-bold">
      Skor: -/400
    </div>

        <a href="../../profil/" class="bg-white text-blue-600 px-3 py-1 rounded-md hover:bg-gray-200">ðŸ‘¤</a>
  </nav>

  <!-- Grid Fitur -->
  <div class="container mx-auto px-4 py-10 grid gap-8 grid-cols-1 md:grid-cols-2 lg:grid-cols-3">

    <!-- QUIZ 1 -->
    <div class="card bg-white rounded-xl shadow-lg p-6 text-center hover:scale-105 transition">
      <h2 class="text-xl font-semibold mb-2">Bab 1 - huruf Hijaiyah</h2>
      <a href="bab1/" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Mulai Quiz</a>
    </div>

    <!-- QUIZ 2 -->
    <div class="card bg-white rounded-xl shadow-lg p-6 text-center hover:scale-105 transition">
      <h2 class="text-xl font-semibold mb-2">Bab 2 - huruf Hijaiyah</h2>
      <a href="bab2/" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Mulai Quiz</a>
    </div>

    <!-- QUIZ 3 -->
    <div class="card bg-white rounded-xl shadow-lg p-6 text-center hover:scale-105 transition">
      <h2 class="text-xl font-semibold mb-2">Bab 1 - huruf Pegon</h2>
      <a href="bab3/" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Mulai Quiz</a>
    </div>

    <!-- QUIZ 4 -->
    <div class="card bg-white rounded-xl shadow-lg p-6 text-center hover:scale-105 transition">
      <h2 class="text-xl font-semibold mb-2">Bab 2 - huruf Pegon</h2>
      <a href="bab4/" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Mulai Quiz</a>
    </div>

  </div>

 <!-- Supabase Script -->
<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const SUPABASE_URL = "https://jpxtbdawajjyrvqrgijd.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpweHRiZGF3YWpqeXJ2cXJnaWpkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzMTI4OTgsImV4cCI6MjA3MTg4ODg5OH0.vEqCzHYBByFZEXeLIBqx6b40x6-tjSYa3Il_b2mI9NE";

  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// KODE DEBUGGING: Salin dan ganti kode lama Anda dengan ini
async function updateTotalScore(classId) {
  console.log("1. Fungsi updateTotalScore dimulai."); // LOG 1

  if (!classId) {
    console.error("GAGAL: Class ID tidak ditemukan dari URL!");
    document.getElementById("total-score").textContent = "Skor: ID Kelas Salah";
    return;
  }
  console.log(`2. Class ID berhasil didapat: ${classId}`); // LOG 2

  const result = await supabase.auth.getUser();
  const user = result?.data?.user;

  if (!user) {
    console.log("3. Pengguna tidak login (anonim). Menampilkan skor 0."); // LOG 3
    document.getElementById("total-score").textContent = "Skor: 0/400";
    return;
  }
  console.log(`4. Pengguna ditemukan: ${user.email}`); // LOG 4

  const pattern = `${classId}_%`;
  console.log(`5. Mencari data di Supabase dengan pola: ${pattern}`); // LOG 5

  const { data, error } = await supabase
    .from("quiz_attempts")
    .select("score")
    .eq("user_id", user.id)
    .like("quiz_id", pattern);

  if (error) {
    console.error("GAGAL: Terjadi error saat mengambil data dari Supabase:", error); // LOG ERROR
    document.getElementById("total-score").textContent = "Gagal Memuat Skor";
    return;
  }

  console.log("6. Kueri Supabase berhasil. Data yang diterima:", data); // LOG 6

  const totalSkor = data?.reduce((sum, row) => sum + (row.score || 0), 0) || 0;
  console.log(`7. Perhitungan selesai. Total Skor: ${totalSkor}`); // LOG 7

  document.getElementById("total-score").textContent = `Skor: ${totalSkor}/400`;
  console.log("8. Tampilan skor berhasil diperbarui."); // LOG 8
}

// Bagian event listener tetap sama
document.addEventListener("DOMContentLoaded", () => {
  const path = window.location.pathname;
  const segments = path.split('/');
  const classIndex = segments.indexOf('kelas');
  let classId = null;

  if (classIndex !== -1 && segments.length > classIndex + 1) {
    const numberId = segments[classIndex + 1];
    if (numberId) {
       classId = `kelas${numberId.padStart(2, '0')}`;
    }
  }
  updateTotalScore(classId);
});

document.addEventListener("DOMContentLoaded", updateTotalScore);
</script>
</body>
</html>